name: Setup Spinnaker
on:
  workflow_dispatch:
    # Inputs the workflow accepts.
    inputs:
      namespace:
        # Friendly description to be shown in the UI instead of 'name'
        description: 'Spinnaker namespace'
        # Default value if no value is explicitly provided
        default: 'spinnaker'
        # Input has to be provided for the workflow to run
        required: false
        # The data type of the input
        type: string
        
jobs:
  OpsMx-Spinnaker:
    runs-on: ubuntu-latest
    steps:

      - name: Display structure of downloaded files
        run: |
           ls -ltra ninja-training-cluster.config           
           kubectl get ns  --kubeconfig ninja-training-cluster.config


          
      - name: Setup OpsMx Helm chart and Install
        run: |
           export KUBECONFIG=ninja-training-cluster.config
           kubectl create ns ${{ inputs.namespace}} 

           #https://${{ secrets.GIT_USERNAME }}:${{ secrets.GIT_TOKEN_TEST }}@github.com/${{ secrets.organisation }}/${{ secrets.repository }}.git
            
           kubectl -n ${{ inputs.namespace}} create secret generic opsmx-gitops-auth  --from-literal=gitcloneparam='https://${{ secrets.GIT_USERNAME }}:${{ secrets.GIT_TOKEN_TEST }}@github.com/${{ secrets.organisation }}/${{ secrets.repository }}.git' --from-literal=gituser=${{ secrets.GIT_USERNAME }} --from-literal=gittoken='${{ secrets.GIT_TOKEN }}'
         
           kubectl -n ${{ inputs.namespace}} create secret generic opsmx-gitops-auth -o yaml 
